var rescope;function import$(n,e){var t,o={}.hasOwnProperty;for(t in e)o.call(e,t)&&(n[t]=e[t]);return n}rescope=function(n){return this.opt=import$({inFrame:!1},n=null==n?{}:n),this.inFrame=this.opt.inFrame,this.global=n.global||("undefined"!=typeof global&&null!==global?global:window),this.scope={},this},rescope.func=[],rescope.prototype=import$(Object.create(Object.prototype),{peekScope:function(){return console.log("in delegate iframe: "+!!this.global._rescopeDelegate),this.global._rescopeDelegate},init:function(){var r=this;return this.inFrame?Promise.resolve():new Promise(function(e,t){var n,o=document.createElement("iframe");return o.setAttribute("name","delegator-"+Math.random().toString(36).substring(2)),o.setAttribute("sandbox","allow-same-origin allow-scripts"),(n=o.style).opacity=0,n.zIndex=-1,n.pointerEvents="none",n.width="0px",n.height="0px",o.onerror=function(n){return t(n)},o.onload=function(){var n=r.iframe=o.contentWindow;return n.rescope=rescope,n._rescopeDelegate=!0,r.iframe.init(),r.frameScope=r.iframe._scope.scope,e()},o.src=URL.createObjectURL(new Blob(["<html><body><script>\nfunction init() {\n  if(!window._scope) { window._scope = new rescope({inFrame:true,global:window}) }\n}\nfunction load(url) { return _scope.load(url); }\nfunction context(url,func) { _scope.context(url,func,true); }\n<\/script></body></html>"],{type:"text/html"})),document.body.appendChild(o)})},context:function(n,e,t){var c,l,o,r,i,u,a,s,p,f=this;for(null==t&&(t=!1),n=Array.isArray(n)?n:[n],c=[],l=[],o={},r=0,i=n.length;r<i;++r){for(p in a=(u=[{},this.scope[n[r].url||n[r]]||{}])[0],s=u[1])a[p]=this.global[p],this.global[p]=s[p],o[p]=s[p];c.push(a),l.push(s)}return e=e(o),(t&&e&&e.then?e:Promise.resolve()).then(function(){for(var n,e,t,o,r=[],i=l.length-1;0<=i;--i){for(o in n=[],e=l[i],t=c[i],e)n.push(f.global[o]=t[o]);r.push(n)}return r})},load:function(n){var s=this;return n?(n=Array.isArray(n)?n:[n],Promise.resolve().then(function(){if(!s.inFrame)return s.iframe.load(n)}).then(function(){return new Promise(function(l,u){var a=function(e,t,o){var r,n,i,c;if(null==o&&(o={}),(t=null==t?0:t)>=e.length)return l(o);for(r=[],n=t,i=e.length;n<i&&(r.push(e[c=n]),null==e[c].async||e[c].async);++n);return r.length?Promise.all(r.map(function(n){n=n.url||n;return s._load(n,o,(s.frameScope||(s.frameScope={}))[n])})).then(function(){return s.context(r.map(function(n){return n.url||n}),function(n){return a(e,t+r.length,import$(o,n))},!0)}).catch(function(n){return u(n)}):l(o)};return a(n,0)})})):Promise.resolve()},_wrapperAlt:function(a,s,p,f){var d=this;return null==p&&(p={}),null==f&&(f={}),new Promise(function(n,e){var t,o,r,i,c,l,u;for(t in u=function(){var n,e=[];for(t in n=p)o=n[t],e.push("var "+t+" = context."+t+";");return e}().join("\n")+"\n",i=function(){var n,e=[];for(t in n=f)o=n[t],e.push("if(typeof("+t+") != 'undefined') { this."+t+" = "+t+"; }");return e}().join("\n")+"\n",r="x"+Math.random().toString(36).substring(2),u="/* URL: "+a+" */\nrescope.func."+r+" = function(context) {\n  return (function() {\n    "+u+"\n    \n    "+s+"\n    "+i+"\n    return this;\n  }).apply(context);\n}",i=d.global.document.createElement("script"),c={},l=d.global)o=l[t],c[t]=o;return i.onerror=function(n){return e(n)},i.onload=function(){return(d.func||(d.func={}))[a]=rescope.func[r],n(import$({},(d.func||(d.func={}))[a](p)))},i.setAttribute("src",URL.createObjectURL(new Blob([u],{type:"text/javascript"}))),d.global.document.body.appendChild(i)})},_wrapper:function(url,code,context,prescope){var _code,k,v,_postcode,_forceScope,ret;return null==context&&(context={}),null==prescope&&(prescope={}),_code="",_code=function(){var n,e=[];for(k in n=context)v=n[k],e.push("var "+k+" = context."+k+";");return e}().join("\n")+"\n",_postcode=function(){var n,e=[];for(k in n=prescope)v=n[k],e.push("if(typeof("+k+") != 'undefined') { this."+k+" = "+k+"; }");return e}().join("\n")+"\n",_forceScope="var global = this;\nvar globalThis = this;\nvar window = this;\nvar self = this;",_forceScope="",_code="(function() {\n  "+_code+"\n  "+_forceScope+"\n  "+code+"\n  "+_postcode+"\n  return this;\n}).apply(context);",ret=eval(_code),import$({},ret)},_load:function(e,t,o){var r=this;return null==t&&(t={}),null==o&&(o={}),this.inFrame?this._loadInFrame(e):ld$.fetch(e,{method:"GET"},{type:"text"}).then(function(n){return r._wrapperAlt(e,n,t,o)}).then(function(n){return r.scope[e]=n})},_loadInFrame:function(u){var a=this;return new Promise(function(o,e){var n,t,r,i,c=a.global.document.createElement("script"),l={};for(n in t=a.global)r=t[n],l[n]=r;return c.onerror=function(n){return e(n)},c.onload=function(){var n,e,t;if(a.scope[u])for(e in n=a.scope[u])n[e],n[e]=a.global[e],a.global[e]=l[e];else for(e in a.scope[u]=n={},t=a.global)t[e],null==l[e]&&null!=a.global[e]&&(n[e]=a.global[e],a.global[e]=l[e]);return o(n)},i=/(https?:)?\/\//.exec(u)?u:window.location.origin+("/"===u[0]?"":"/")+u,c.setAttribute("src",i),a.global.document.body.appendChild(c)})}}),"undefined"!=typeof module&&null!==module&&(module.exports=rescope),"undefined"!=typeof window&&null!==window&&(window.rescope=rescope);