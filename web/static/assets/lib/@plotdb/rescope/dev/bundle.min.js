(()=>{var l,c,p,h,n,d;function m(n,e){var t,r={}.hasOwnProperty;for(t in e)r.call(e,t)&&(n[t]=e[t]);return n}function v(n,e){for(var t=-1,r=e.length>>>0;++t<r;)if(n===e[t])return 1}p=function(n,e){return d.__node&&"undefined"!=typeof fs&&null!==fs&&!/^https?:/.exec(n)?new Promise(function(t,r){return fs.readFile(n,function(n,e){return n?r(n):t(e.toString())})}):fetch(n,e).then(function(i){var n;return i&&i.ok?i.text():i?i.clone().text().then(function(n){var e,t=i.status||404,r=new Error(t+" "+n);r.name="lderror",r.id=t,r.message=n,t=r;try{(e=JSON.parse(n))&&"lderror"===e.name&&(m(t,e).json=e)}catch(n){0}return Promise.reject(t)}):Promise.reject(((n=new Error("404")).name="lderror",n.id=404,n))})},(h=function(n){var e,t,i,o,r,s=this;return this.lc=(n=null==n?{}:n).context||{},this.id=Math.random().toString(36).substring(2),n.iframe?this.iframe=n.iframe:(this.iframe=e=c.createElement("iframe"),(t=e.style).position="absolute",t.top=0,t.left=0,t.width=0,t.height=0,t.pointerEvents="none",t.opacity=0,e.setAttribute("title","rescope script loader"),e.setAttribute("name","pdb-proxin-"+this.id),c.body.appendChild(e)),i=Object.fromEntries(Reflect.ownKeys(this.iframe.contentWindow).map(function(n){return[n,!0]})),o={},this._proxy=new Proxy(n.target||l,{get:function(n,e,t){var r;return null!=s.lc[e]?s.lc[e]:null!=o[e]?o[e]:"function"==typeof n[e]?(r=Reflect.get(n,e,t),o[e]=new Proxy(r.bind(n),{get:function(n,e,t){return Reflect.get(v(e,n)?n:r,e,t)}})):null!=i[e]?n[e]:void 0},set:function(n,e,t){return"_rspvarsetcb_"===e?r.on(t.k,t.f):(r.fire(e,t),i[e]?n[e]=t:s.lc[e]=t),!0},defineProperty:function(n,e,t){return Object.defineProperty(s.lc,e,t),s._proxy}}),r={evthdr:{},on:function(n,t){var r=this;return(Array.isArray(n)?n:[n]).map(function(n){var e;return((e=r.evthdr)[n]||(e[n]=[])).push(t)})},fire:function(n){for(var e,t,r,i,o=[],s=[],c=1,u=arguments.length;c<u;++c)s.push(arguments[c]);for(e=s,c=0,r=(t=this.evthdr[n]||[]).length;c<r;++c)i=t[c],o.push(i.apply(this,e));return o}},this}).prototype=((n=Object.create(Object.prototype)).proxy=function(){return this._proxy},n.ctx=function(){return this.lc},n),(d=function(n){var e,t;return null==n&&(n={}),this.id=Math.random().toString(36).substring(2),this.iframe=e=c.createElement("iframe"),this._cache={},this.proxy=new h,this.registry(n.registry||"/assets/lib/"),(t=e.style).position="absolute",t.top=0,t.left=0,t.width=0,t.height=0,t.pointerEvents="none",t.opacity=0,e.setAttribute("title","rescope script loader"),e.setAttribute("name","pdb-rescope-"+this.id),c.body.appendChild(e),e.contentWindow.document.body.innerHTML=(n.preloads||[]).map(function(n){return'<script type="text/javascript" src="'+n+'"><\/script>'}).join(""),this}).env=function(n){n=[n,n.document];return l=n[0],c=n[1],n},d.prop={legacy:{webkitStorageInfo:!0}},d.id=function(n){var e=n.path||("js"===n.type?"index.min.js":"css"===n.type?"index.min.css":"index.html");return n.id||n.url||(n.ns?n.ns+":":"")+n.name+"@"+(n.version||"main")+":"+e},d._cache={},d._ver={map:{},list:{}},d.cache=function(n){var e,t,r,i,o,s,c,u,f,a,l;if((n="string"==typeof n?{url:n}:n).id||(n.id=d.id(n)),e=this._cache[n.id])return e;if(n.id&&!n.name?((o=n.id.split(":")).length<=2?(t=o[0],r=o[1],i=o[2]):(i=o[0],t=o[1],r=o[2]),s=(o=(o=/^(@?[^@]+)(?:@([^:]+))?$/.exec(t))||["",n.id,""])[1],c=o[2]):(i=(u=[n.ns,n.name,n.version||"",n.path||""])[0],s=u[1],c=u[2],r=u[3]),/^[0-9.]+$/.exec(c)){if((e=((u=this._ver.map)[s]||(u[s]={}))[c])&&(c=e),e=this._cache[d.id({ns:i,name:s,version:c,path:r})])return e;for(f=0,a=((u=this._ver.list)[s]||(u[s]=[])).length;f<a;++f)if(l=f,l=this._ver.list[s][l],semver.fit(l,c)&&(this._ver.map[s][c]=l,n.id=d.id({ns:i,name:s,version:l,path:r}),e=this._cache[n.id]))return e}return v(c,(u=this._ver.list)[s]||(u[s]=[]))||this._ver.list[s].push(c),this._cache[n.id]=n},d.prototype=((n=Object.create(Object.prototype)).peekScope=function(){return!1},n.init=function(){return Promise.resolve()},n._ref=function(n){var e,t;return"string"==typeof n&&(n={url:n}),"function"==typeof(e=this._reg.url||this._reg)&&((t=m({},n)).url=e(n),n=t),this._reg.fetch?this._reg.fetch(n):n.url},n.registry=function(n){return"string"==typeof n?("/"===n[n.length-1]&&(n=n.substring(0,n.length-1)),this._reg=(e=n,function(n){return e+"/"+n.name+"/"+(n.version||"main")+"/"+(n.path||"index.min.js")})):this._reg=n;var e},n.cache=function(n){var e;return(n="string"==typeof n?{url:n}:n).id||(n.id=d.id(n)),(e=this._cache[n.id])||(this._cache[n.id]=d.cache(n))},n.exports=function(n){var e,t,r=[],i=(n=null==n?{}:n).ctx||{},n="string"==typeof n.libs?[n.libs]:n.libs||[],o=(e=[{},this.iframe.contentWindow])[0],s=e[1];for(t in i)o[t]=s[t],s[t]=i[t];for(t in this._exports(n,0,i),o)r.push(s[t]=o[t]);return r},n._exports=function(n,e,t){var r,i,o,s,c,u,f=[];if(null==t&&(t={}),r=n[e=null==e?0:e]){if(i=(u=[{},(r=this.cache(r)).fprop,this.iframe.contentWindow])[0],o=u[1],s=u[2],o)for(c in o)i[c]=s[c],s[c]=o[c];else if(r.fprop=o={},r.prop={},r.propIniting=!0,r.gen)m(o,r.gen.apply(s,[s,s,s])),r.prop=Object.fromEntries((()=>{var n=[];for(c in o)n.push([c,null]);return n})());else{for(c in Object.fromEntries(Reflect.ownKeys(s).filter(function(n){return!d.prop.legacy[n]}).map(function(n){return[n,!0]})))i[c]=s[c];try{s.eval((r.code||"").replace('"use strict";',""))}catch(n){throw u=n,console.error("[@plotdb/rescope] Parse failed",{url:r.url,ns:r.ns,name:r.name,version:r.version,path:r.path}),console.error("[@plotdb/rescope] with this error:",u),u}for(c in Object.fromEntries(Reflect.ownKeys(s).filter(function(n){return!d.prop.legacy[n]}).map(function(n){return[n,!0]})))s[c]!==i[c]&&"NaN"!==c&&(o[c]=s[c],r.prop[c]=null)}for(c in o)t[c]=o[c];for(c in this._exports(n,e+1),o)f.push(s[c]=i[c]);return f}},n._wrap=function(n,e,t){var r,i,o,s,c;for(c in null==e&&(e={}),null==t&&(t={}),r=/^[a-zA-Z_$][a-zA-Z0-9_$]*$/,o="var window, global, globalThis, self, __ret = {}; __win = {};\nwindow = global = globalThis = self = window = scope;",s=function(n){return"window['_rspvarsetcb_'] = {k:'"+n+"',f:function(v){"+n+"=v}};"},i=(n=null==n?{}:n).prop||{})r.exec(c)&&(o+="var "+c+";"+s(c)),o+="__win['"+c+"'] = win['"+c+"']; win['"+c+"'] = undefined;";for(c in e)o+="window['"+c+"'] = ctx['"+c+"'];",r.exec(c)&&(o+="var "+c+" = window['"+c+"'];"+s(c));for(c in o+=n.code+";",i)r.exec(c)?o+="if(!("+c+")) { "+c+" = scope['"+c+"']; }\n__ret['"+c+"'] = "+c+" || window['"+c+"'] || win['"+c+"'] || this['"+c+"'];\nwin['"+c+"'] = __win['"+c+"'];":o+="__ret['"+c+"'] = window['"+c+"'] || win['"+c+"'] || this['"+c+"'];\nwin['"+c+"'] = __win['"+c+"'];";return o+="return __ret;",t.codeOnly?"function(scope, ctx, win){"+o+"}":new Function("scope","ctx","win",o)},n.load=function(n,r,i,o){var e,s,c,u,f,a=this;return null==r&&(r={}),null==i&&(i=!1),null==o&&(o=!1),e=(n=(Array.isArray(n)?n:[n]).map(function(n){return a.cache(n)})).px||(n.px=r&&r.p?r.p:new h),s=e.ctx(),c=e.proxy(),u=[n],(f=function(n){var e,t;return(e=u[n=null==n?0:n])?(t=e.map(function(e){var n;return!e.code&&!e.gen||i?(n=a._ref(e)).then?n.then(function(n){return e.code=n.content,a.cache((e.id=void 0,e.version=n.version,e.code=n.content,e))}):p(n,{method:"GET"}).then(function(n){return e.code=n}):Promise.resolve()}),Promise.all(t).then(function(){if(!o)return a.exports({libs:e,ctx:r.f}),e.map(function(n){return n.propIniting&&(n.gen||(n.gen=a._wrap(n,s)),n.prop=n.gen.apply(c,[c,s,l]),n.propIniting=!1),m(s,n.prop)})}).then(function(){return s}).then(function(){return f(n+1)})):Promise.resolve(s)})(0)},n.context=function(n,e,t){var r;return"function"!=typeof e&&(e=(r=[t,e])[0],t=r[1]),this.load(n,t).then(function(n){return e?e(n):n})},n),d.env("undefined"!=typeof self&&null!==self?self:globalThis),d.proxin=h,d.dualContext=function(){return{p:new h,f:{},ctx:function(){return this.p.ctx()}}},d.prototype.bundle=function(e){var t,n,r,i,o=this;for(r in null==e&&(e={}),e=(Array.isArray(e)?e:[e]).map(function(n){return o.cache(n)}),t={},e.filter(function(n){return n&&n.id}).map(function(n){return t[n.id]=n}),n=[],t)i=t[r],n.push(i);return e=n,this.load(e,null,!0,!0).then(function(){var n=e.filter(function(n){return n.code}).map(function(n){return JSON.stringify({url:n.url,id:n.id,ns:n.ns,name:n.name,version:n.version,path:n.path,code:n.code})});return Promise.resolve("["+n.join(",")+"].forEach(function(o){rescope.cache(o);})")})},"undefined"!=typeof module&&null!==module?module.exports=d:"undefined"!=typeof window&&null!==window&&(window.rescope=d)})();
