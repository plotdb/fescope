var win,doc,_fetch,proxin,ref$,rsp;function import$(t,e){var n,r={}.hasOwnProperty;for(n in e)r.call(e,n)&&(t[n]=e[n]);return t}function in$(t,e){for(var n=-1,r=e.length>>>0;++n<r;)if(t===e[n])return!0;return!1}_fetch=function(t,e){return"undefined"==typeof fs||null===fs||/^https:/.exec(t)?fetch(t,e).then(function(i){var t;return i&&i.ok?i.text():i?i.clone().text().then(function(t){var e,n=i.status||404,r=new Error(n+" "+t);r.name="lderror",r.id=n,r.message=t,n=r;try{(e=JSON.parse(t))&&"lderror"===e.name&&(import$(n,e).json=e)}catch(t){0}return Promise.reject(n)}):Promise.reject(((t=new Error("404")).name="lderror",t.id=404,t))}):new Promise(function(n,r){return fs.readFile(t,function(t,e){return t?r(t):n(e.toString())})})},(proxin=function(t){var e,n,r,i,o=this;return this.lc=(t=null==t?{}:t).context||{},this.id=Math.random().toString(36).substring(2),t.iframe?this.iframe=t.iframe:(this.iframe=e=doc.createElement("iframe"),(n=e.style).position="absolute",n.top=0,n.left=0,n.width=0,n.height=0,n.pointerEvents="none",n.opacity=0,e.setAttribute("title","rescope script loader"),e.setAttribute("name","pdb-proxin-"+this.id),e.setAttribute("sandbox","allow-same-origin allow-scripts"),doc.body.appendChild(e)),r=Object.fromEntries(Reflect.ownKeys(this.iframe.contentWindow).map(function(t){return[t,!0]})),i={},this._proxy=new Proxy(t.target||win,{get:function(t,e,n){return null!=o.lc[e]?o.lc[e]:null!=i[e]?i[e]:"function"==typeof t[e]?i[e]=t[e].bind(t):null!=r[e]?t[e]:void 0},set:function(t,e,n){return r[e]?t[e]=n:o.lc[e]=n,!0}}),this}).prototype=((ref$=Object.create(Object.prototype)).proxy=function(){return this._proxy},ref$.ctx=function(){return this.lc},ref$),(rsp=function(t){var e,n;return null==t&&(t={}),this.id=Math.random().toString(36).substring(2),this.iframe=e=doc.createElement("iframe"),this._cache={},this.proxy=new proxin,this.registry(t.registry||"/assets/lib/"),(n=e.style).position="absolute",n.top=0,n.left=0,n.width=0,n.height=0,n.pointerEvents="none",n.opacity=0,e.setAttribute("title","rescope script loader"),e.setAttribute("name","pdb-rescope-"+this.id),e.setAttribute("sandbox","allow-same-origin allow-scripts"),doc.body.appendChild(e),e.contentWindow.document.body.innerHTML=(t.preloads||[]).map(function(t){return'<script type="text/javascript" src="'+t+'"><\/script>'}).join(""),this}).env=function(t){t=[t,t.document];return win=t[0],doc=t[1],t},rsp.prop={legacy:{webkitStorageInfo:!0}},rsp.id=function(t){return t.id||t.url||(t.ns?t.ns+":":"")+t.name+"@"+(t.version||"main")+":"+(t.path||"index.html")},rsp._cache={},rsp._ver={map:{},list:{}},rsp.cache=function(t){var e,n,r,i,o,s,c,p,u,f,l;if((t="string"==typeof t?{url:t}:t).id||(t.id=rsp.id(t)),e=this._cache[t.id])return e;if(t.id&&!t.name?((o=t.id.split(":")).length<=2?(n=o[0],r=o[1],i=o[2]):(i=o[0],n=o[1],r=o[2]),s=(o=(o=/^(@?[^@]+)(?:@([^:]+))?$/.exec(n))||["",t.id,""])[1],c=o[2]):(i=(p=[t.ns,t.name,t.version||"",t.path||""])[0],s=p[1],c=p[2],r=p[3]),/^[0-9.]+$/.exec(c)){if((e=((p=this._ver.map)[s]||(p[s]={}))[c])&&(c=e),e=this._cache[rsp.id({ns:i,name:s,version:c,path:r})])return e;for(u=0,f=((p=this._ver.list)[s]||(p[s]=[])).length;u<f;++u)if(l=u,l=this._ver.list[s][l],semver.fit(l,c)&&(this._ver.map[s][c]=l,t.id=rsp.id({ns:i,name:s,version:l,path:r}),e=this._cache[t.id]))return e}return in$(c,(p=this._ver.list)[s]||(p[s]=[]))||this._ver.list[s].push(c),this._cache[t.id]=t},rsp.prototype=((ref$=Object.create(Object.prototype)).peekScope=function(){return!1},ref$.init=function(){return Promise.resolve()},ref$._ref=function(t){return"string"==typeof t?t:t.url||(this._reg.fetch?this._reg.fetch(t):this._reg(t))},ref$.registry=function(t){return"string"==typeof t?("/"===t[t.length-1]&&(t=t.substring(0,t.length-1)),this._reg=(e=t,function(t){return e+"/"+t.name+"/"+(t.version||"main")+"/"+(t.path||"index.min.js")})):this._reg=t;var e},ref$.cache=function(t){var e;return(t="string"==typeof t?{url:t}:t).id||(t.id=rsp.id(t)),(e=this._cache[t.id])||(this._cache[t.id]=rsp.cache(t))},ref$.exports=function(t){var e,n,r=[],i=(t=null==t?{}:t).ctx||{},t="string"==typeof t.libs?[t.libs]:t.libs||[],o=(e=[{},this.iframe.contentWindow])[0],s=e[1];for(n in i)o[n]=s[n],s[n]=i[n];for(n in this._exports(t,0,i),o)r.push(s[n]=o[n]);return r},ref$._exports=function(t,e,n){var r,i,o,s,c,p,u=[];if(null==n&&(n={}),r=t[e=null==e?0:e]){if(o=(i=[{},(r=this.cache(r)).fprop,this.iframe.contentWindow])[0],s=i[1],c=i[2],s)for(p in s)o[p]=c[p],c[p]=s[p];else if(r.fprop=s={},r.prop={},r.propIniting=!0,r.gen)import$(s,r.gen.apply(c,[c,c,c])),r.prop=Object.fromEntries(function(){var t=[];for(p in s)t.push([p,null]);return t}());else{for(p in Object.fromEntries(Reflect.ownKeys(c).filter(function(t){return!rsp.prop.legacy[t]}).map(function(t){return[t,!0]})))o[p]=c[p];for(p in c.eval(r.code),Object.fromEntries(Reflect.ownKeys(c).filter(function(t){return!rsp.prop.legacy[t]}).map(function(t){return[t,!0]})))c[p]!==o[p]&&"NaN"!==p&&(s[p]=c[p],r.prop[p]=null)}for(p in s)n[p]=s[p];for(p in this._exports(t,e+1),s)u.push(c[p]=o[p]);return u}},ref$._wrap=function(t,e,n){var r,i,o;for(o in null==e&&(e={}),null==n&&(n={}),i="var window, global, globalThis, self, __ret = {}; __win = {};\nwindow = global = globalThis = self = window = scope;",r=(t=null==t?{}:t).prop||{})i+="var "+o+"; __win['"+o+"'] = win['"+o+"']; win['"+o+"'] = undefined;";for(o in e)i+="var "+o+" = window['"+o+"'] = ctx['"+o+"'];";for(o in i+=t.code+";",r)i+="__ret['"+o+"'] = "+o+" || window['"+o+"'] || win['"+o+"'] || this['"+o+"'];\nwin['"+o+"'] = __win['"+o+"'];";return i+="return __ret;",n.codeOnly?"function(scope, ctx, win){"+i+"}":new Function("scope","ctx","win",i)},ref$.load=function(t,e,n,r){var i,o,s,c=this;return null==e&&(e={}),null==n&&(n=!1),null==r&&(r=!1),s=(t=(Array.isArray(t)?t:[t]).map(function(t){return c.cache(t)})).px||(t.px=e&&e.p?e.p:new proxin),i=s.ctx(),o=s.proxy(),s=t.map(function(e){var t;return!e.code&&!e.gen||n?(t=c._ref(e)).then?t.then(function(t){return e.code=t.content,c.cache((e.id=void 0,e.version=t.version,e.code=t.content,e))}):_fetch(t,{method:"GET"}).then(function(t){return e.code=t}):Promise.resolve()}),Promise.all(s).then(function(){if(!r)return c.exports({libs:t,ctx:e.f}),t.map(function(t){return t.propIniting&&(t.gen||(t.gen=c._wrap(t,i)),t.prop=t.gen.apply(o,[o,i,win]),t.propIniting=!1),import$(i,t.prop)})}).then(function(){return i})},ref$.context=function(t,e,n){var r;return"function"!=typeof e&&(e=(r=[n,e])[0],n=r[1]),this.load(t,n).then(function(t){return e?e(t):t})},ref$),rsp.env("undefined"!=typeof self&&null!==self?self:globalThis),rsp.proxin=proxin,rsp.dualContext=function(){return{p:new proxin,f:{},ctx:function(){return this.p.ctx()}}},"undefined"!=typeof module&&null!==module?module.exports=rsp:"undefined"!=typeof window&&null!==window&&(window.rescope=rsp);
