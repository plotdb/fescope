var win,doc,_fetch,proxin,ref$,rsp;function import$(n,t){var e,r={}.hasOwnProperty;for(e in t)r.call(t,e)&&(n[e]=t[e]);return n}function in$(n,t){for(var e=-1,r=t.length>>>0;++e<r;)if(n===t[e])return!0;return!1}_fetch=function(n,t){return"undefined"==typeof fs||null===fs||/^https:/.exec(n)?fetch(n,t).then(function(i){var n;return i&&i.ok?i.text():i?i.clone().text().then(function(n){var t,e=i.status||404,r=new Error(e+" "+n);r.name="lderror",r.id=e,r.message=n,e=r;try{(t=JSON.parse(n))&&"lderror"===t.name&&(import$(e,t).json=t)}catch(n){0}return Promise.reject(e)}):Promise.reject(((n=new Error("404")).name="lderror",n.id=404,n))}):new Promise(function(e,r){return fs.readFile(n,function(n,t){return n?r(n):e(t.toString())})})},(proxin=function(n){var t,e,r,i,o=this;return this.lc=(n=null==n?{}:n).context||{},this.id=Math.random().toString(36).substring(2),n.iframe?this.iframe=n.iframe:(this.iframe=t=doc.createElement("iframe"),(e=t.style).position="absolute",e.top=0,e.left=0,e.width=0,e.height=0,e.pointerEvents="none",e.opacity=0,t.setAttribute("title","rescope script loader"),t.setAttribute("name","pdb-proxin-"+this.id),t.setAttribute("sandbox","allow-same-origin allow-scripts"),doc.body.appendChild(t)),r=Object.fromEntries(Reflect.ownKeys(this.iframe.contentWindow).map(function(n){return[n,!0]})),i={},this._proxy=new Proxy(n.target||win,{get:function(n,t,e){return null!=o.lc[t]?o.lc[t]:null!=i[t]?i[t]:"function"==typeof n[t]?i[t]=n[t].bind(n):null!=r[t]?n[t]:void 0},set:function(n,t,e){return r[t]?n[t]=e:o.lc[t]=e,!0}}),this}).prototype=((ref$=Object.create(Object.prototype)).proxy=function(){return this._proxy},ref$.ctx=function(){return this.lc},ref$),(rsp=function(n){var t,e;return null==n&&(n={}),this.id=Math.random().toString(36).substring(2),this.iframe=t=doc.createElement("iframe"),this._cache={},this.proxy=new proxin,this.registry(n.registry||"/assets/lib/"),(e=t.style).position="absolute",e.top=0,e.left=0,e.width=0,e.height=0,e.pointerEvents="none",e.opacity=0,t.setAttribute("title","rescope script loader"),t.setAttribute("name","pdb-rescope-"+this.id),t.setAttribute("sandbox","allow-same-origin allow-scripts"),doc.body.appendChild(t),t.contentWindow.document.body.innerHTML=(n.preloads||[]).map(function(n){return'<script type="text/javascript" src="'+n+'"><\/script>'}).join(""),this}).env=function(n){n=[n,n.document];return win=n[0],doc=n[1],n},rsp.prop={legacy:{webkitStorageInfo:!0}},rsp.id=function(n){return n.id||n.url||(n.ns?n.ns+":":"")+n.name+"@"+(n.version||"main")+":"+(n.path||"index.html")},rsp._cache={},rsp._ver={map:{},list:{}},rsp.cache=function(n){var t,e,r,i,o,s,c,u,p,f,l;if((n="string"==typeof n?{url:n}:n).id||(n.id=rsp.id(n)),t=this._cache[n.id])return t;if(n.id&&!n.name?((o=n.id.split(":")).length<=2?(e=o[0],r=o[1],i=o[2]):(i=o[0],e=o[1],r=o[2]),s=(o=(o=/^(@?[^@]+)(?:@([^:]+))?$/.exec(e))||["",n.id,""])[1],c=o[2]):(i=(u=[n.ns,n.name,n.version||"",n.path||""])[0],s=u[1],c=u[2],r=u[3]),/^[0-9.]+$/.exec(c)){if((t=((u=this._ver.map)[s]||(u[s]={}))[c])&&(c=t),t=this._cache[rsp.id({ns:i,name:s,version:c,path:r})])return t;for(p=0,f=((u=this._ver.list)[s]||(u[s]=[])).length;p<f;++p)if(l=p,l=this._ver.list[s][l],semver.fit(l,c)&&(this._ver.map[s][c]=l,n.id=rsp.id({ns:i,name:s,version:l,path:r}),t=this._cache[n.id]))return t}return in$(c,(u=this._ver.list)[s]||(u[s]=[]))||this._ver.list[s].push(c),this._cache[n.id]=n},rsp.prototype=((ref$=Object.create(Object.prototype)).peekScope=function(){return!1},ref$.init=function(){return Promise.resolve()},ref$._ref=function(n){return"string"==typeof n?n:n.url||(this._reg.fetch?this._reg.fetch(n):this._reg(n))},ref$.registry=function(n){return"string"==typeof n?("/"===n[n.length-1]&&(n=n.substring(0,n.length-1)),this._reg=(t=n,function(n){return t+"/"+n.name+"/"+(n.version||"main")+"/"+(n.path||"index.min.js")})):this._reg=n;var t},ref$.cache=function(n){var t;return(n="string"==typeof n?{url:n}:n).id||(n.id=rsp.id(n)),(t=this._cache[n.id])||(this._cache[n.id]=rsp.cache(n))},ref$.exports=function(n){var t,e,r=[],i=(n=null==n?{}:n).ctx||{},n="string"==typeof n.libs?[n.libs]:n.libs||[],o=(t=[{},this.iframe.contentWindow])[0],s=t[1];for(e in i)o[e]=s[e],s[e]=i[e];for(e in this._exports(n,0,i),o)r.push(s[e]=o[e]);return r},ref$._exports=function(n,t,e){var r,i,o,s,c,u,p=[];if(null==e&&(e={}),r=n[t=null==t?0:t]){if(o=(i=[{},(r=this.cache(r)).fprop,this.iframe.contentWindow])[0],s=i[1],c=i[2],s)for(u in s)o[u]=c[u],c[u]=s[u];else if(r.fprop=s={},r.prop={},r.propIniting=!0,r.gen)import$(s,r.gen.apply(c,[c,c,c])),r.prop=Object.fromEntries(function(){var n=[];for(u in s)n.push([u,null]);return n}());else{for(u in Object.fromEntries(Reflect.ownKeys(c).filter(function(n){return!rsp.prop.legacy[n]}).map(function(n){return[n,!0]})))o[u]=c[u];for(u in c.eval(r.code),Object.fromEntries(Reflect.ownKeys(c).filter(function(n){return!rsp.prop.legacy[n]}).map(function(n){return[n,!0]})))c[u]!==o[u]&&"NaN"!==u&&(s[u]=c[u],r.prop[u]=null)}for(u in s)e[u]=s[u];for(u in this._exports(n,t+1),s)p.push(c[u]=o[u]);return p}},ref$._wrap=function(n,t,e){var r,i,o;for(o in null==t&&(t={}),null==e&&(e={}),i="var window, global, globalThis, self, __ret = {}; __win = {};\nwindow = global = globalThis = self = window = scope;",r=(n=null==n?{}:n).prop||{})i+="var "+o+"; __win['"+o+"'] = win['"+o+"']; win['"+o+"'] = undefined;";for(o in t)i+="var "+o+" = window['"+o+"'] = ctx['"+o+"'];";for(o in i+=n.code+";",r)i+="__ret['"+o+"'] = "+o+" || window['"+o+"'] || win['"+o+"'] || this['"+o+"'];\nwin['"+o+"'] = __win['"+o+"'];";return i+="return __ret;",e.codeOnly?"function(scope, ctx, win){"+i+"}":new Function("scope","ctx","win",i)},ref$.load=function(n,t,e,r){var i,o,s,c=this;return null==t&&(t={}),null==e&&(e=!1),null==r&&(r=!1),s=(n=(Array.isArray(n)?n:[n]).map(function(n){return c.cache(n)})).px||(n.px=t&&t.p?t.p:new proxin),i=s.ctx(),o=s.proxy(),s=n.map(function(t){var n;return!t.code&&!t.gen||e?(n=c._ref(t)).then?n.then(function(n){return t.code=n.content,c.cache((t.id=void 0,t.version=n.version,t.code=n.content,t))}):_fetch(n,{method:"GET"}).then(function(n){return t.code=n}):Promise.resolve()}),Promise.all(s).then(function(){if(!r)return c.exports({libs:n,ctx:t.f}),n.map(function(n){return n.propIniting&&(n.gen||(n.gen=c._wrap(n,i)),n.prop=n.gen.apply(o,[o,i,win]),n.propIniting=!1),import$(i,n.prop)})}).then(function(){return i})},ref$.context=function(n,t,e){var r;return"function"!=typeof t&&(t=(r=[e,t])[0],e=r[1]),this.load(n,e).then(function(n){return t?t(n):n})},ref$),rsp.env("undefined"!=typeof self&&null!==self?self:globalThis),rsp.proxin=proxin,rsp.dualContext=function(){return{p:new proxin,f:{},ctx:function(){return this.p.ctx()}}},rsp.prototype.bundle=function(t){var e,n,r,i,o=this;for(r in null==t&&(t={}),t=(Array.isArray(t)?t:[t]).map(function(n){return o.cache(n)}),e={},t.filter(function(n){return n&&n.id}).map(function(n){return e[n.id]=n}),n=[],e)i=e[r],n.push(i);return t=n,this.load(t,null,!0,!0).then(function(){var n=t.filter(function(n){return n.code}).map(function(n){return JSON.stringify({url:n.url,id:n.id,ns:n.ns,name:n.name,version:n.version,path:n.path,code:n.code})});return Promise.resolve("["+n.join(",")+"].forEach(function(o){rescope.cache(o);})")})},"undefined"!=typeof module&&null!==module?module.exports=rsp:"undefined"!=typeof window&&null!==window&&(window.rescope=rsp);
