(function(){function t(t,n){var e={}.hasOwnProperty;for(var r in n)e.call(n,r)&&(t[r]=n[r]);return t}var n,e,r,i,o;(r=function(t){var r,i,o,c,u=this;return null==t&&(t={}),this.lc=t.context||{},this.id=Math.random().toString(36).substring(2),t.iframe?this.iframe=t.iframe:(this.iframe=r=e.createElement("iframe"),(i=r.style).position="absolute",i.top=0,i.left=0,i.width=0,i.height=0,i.pointerEvents="none",i.opacity=0,r.setAttribute("title","rescope script loader"),r.setAttribute("name","pdb-proxin-"+this.id),r.setAttribute("sandbox","allow-same-origin allow-scripts"),e.body.appendChild(r)),o=Object.fromEntries(Reflect.ownKeys(this.iframe.contentWindow).map(function(t){return[t,!0]})),c={},this._proxy=new Proxy(t.target||n,{get:function(t,n,e){if(null!=u.lc[n])return u.lc[n];if(null!=c[n])return c[n];if(null!=o[n])return"function"==typeof t[n]?c[n]=t[n].bind(t):t[n]},set:function(t,n,e){return o[n]?(t[n]=e,!0):(u.lc[n]=e,!0)}}),this}).prototype=(i=Object.create(Object.prototype),i.proxy=function(){return this._proxy},i.ctx=function(){return this.lc},i),(o=function(t){var n,i;return null==t&&(t={}),this.id=Math.random().toString(36).substring(2),this.iframe=n=e.createElement("iframe"),this._cache={},this.proxy=new r,this.registry(t.registry||"/assets/lib/"),i=n.style,i.position="absolute",i.top=0,i.left=0,i.width=0,i.height=0,i.pointerEvents="none",i.opacity=0,n.setAttribute("title","rescope script loader"),n.setAttribute("name","pdb-rescope-"+this.id),n.setAttribute("sandbox","allow-same-origin allow-scripts"),e.body.appendChild(n),n.contentWindow.document.body.innerHTML=(t.preloads||[]).map(function(t){return'<script type="text/javascript" src="'+t+'"><\/script>'}).join(""),this}).env=function(t){var r;return r=[t,t.document],n=r[0],e=r[1],r},o.prop={legacy:{webkitStorageInfo:!0}},o.id=function(t){return t.id||t.url||t.name+"@"+t.version+"/"+t.path},o._cache={},o.cache=function(n){var e;return"string"==typeof n&&(n={url:n}),n.id||(n.id=o.id(n)),(e=o._cache[n.id])?e:o._cache[n.id]=t({},n)},o.prototype=(i=Object.create(Object.prototype),i.peekScope=function(){return!1},i.init=function(){return Promise.resolve()},i._url=function(t){var n;return"string"==typeof t?t:(n=t.url)?n:this._reg(t)},i.registry=function(t){return"string"==typeof t?("/"===t[t.length-1]&&(t=t.substring(0,t.length-1)),this._reg=function(t){return function(n){return t+"/"+n.name+"/"+(n.version||"main")+"/"+(n.path||"index.min.js")}}(t)):this._reg=t},i.cache=function(n){var e,r;return"string"==typeof n&&(n={url:n}),n.id||(n.id=o.id(n)),(e=this._cache[n.id])?e:(r=o._cache[n.id])?this._cache[n.id]=r:this._cache[n.id]=t({},n)},i.bundle=function(t){var n=this;return null==t&&(t=[]),t=(Array.isArray(t)?t:[t]).map(function(t){return n.cache(t)}),this.load(t).then(function(){var e;return e=t.filter(function(t){return t.code}).map(function(t){var e;return e=n._wrap(t,{},{codeOnly:!0}),"{id:'"+t.id+"',gen:"+e+"}"}),Promise.resolve("["+e.join(",")+"].forEach(function(o){rescope.cache(o);})")})},i.exports=function(t){var n,e,r,i,o,c,u=[];null==t&&(t={}),n=t.ctx||{},e="string"==typeof t.libs?[t.libs]:t.libs||[],i=(r=[{},this.iframe.contentWindow])[0],o=r[1];for(c in n)i[c]=o[c],o[c]=n[c];this._exports(e,0);for(c in n)u.push(o[c]=i[c]);return u},i._exports=function(n,e){var r,i,c,u,s,a,l,p,f=[];if(null==e&&(e=0),r=n[e]){if(r=this.cache(r),i=[{},r.fprop,this.iframe.contentWindow],c=i[0],u=i[1],s=i[2],u)for(a in u)c[a]=s[a],s[a]=u[a];else if(r.fprop=u={},r.prop={},r.gen)t(u,r.gen(s,s,s)),r.prop=Object.fromEntries(function(){var t=[];for(a in u)t.push([a,null]);return t}()),r.propIniting=!0;else{l=Object.fromEntries(Reflect.ownKeys(s).filter(function(t){return!o.prop.legacy[t]}).map(function(t){return[t,!0]}));for(a in l)c[a]=s[a];s.eval(r.code),p=Object.fromEntries(Reflect.ownKeys(s).filter(function(t){return!o.prop.legacy[t]}).map(function(t){return[t,!0]}));for(a in p)s[a]!==c[a]&&"NaN"!==a&&(u[a]=s[a],r.prop[a]=null,r.propIniting=!0)}this._exports(n,e+1);for(a in u)f.push(s[a]=c[a]);return f}},i._wrap=function(t,n,e){var r,i,o;null==t&&(t={}),null==n&&(n={}),null==e&&(e={}),r=t.prop||{},i="var window, global, globalThis, self, __ret = {}; __win = {};\nwindow = global = globalThis = window = scope;";for(o in r)i+="var "+o+"; __win['"+o+"'] = win['"+o+"']; win['"+o+"'] = undefined;";for(o in n)i+="var "+o+" = window['"+o+"'] = ctx['"+o+"'];";i+=t.code+";";for(o in r)i+="__ret['"+o+"'] = "+o+" || window['"+o+"'] || win['"+o+"'] || this['"+o+"'];\nwin['"+o+"'] = __win['"+o+"'];";return i+="return __ret;",e.codeOnly?" function(scope, ctx, win) { "+i+" } ":new Function("scope","ctx","win",i)},i.load=function(n,e){var i,o,c,u=this;return n=(Array.isArray(n)?n:[n]).map(function(t){return u.cache(t)}),e=n.px?n.px:n.px=e||new r,i=e.ctx(),o=e.proxy(),c=n.map(function(t){return t.code||t.gen?Promise.resolve():ld$.fetch(u._url(t),{method:"GET"},{type:"text"}).then(function(n){return t.code=n})}),Promise.all(c).then(function(){return u.exports({libs:n}),n.map(function(n){return n.propIniting&&(n.gen||(n.gen=u._wrap(n,i)),n.prop=n.gen(o,i,window),n.propIniting=!1),t(i,n.prop)})}).then(function(){return i})},i.context=function(t,n,e){var r;return"function"!=typeof n&&(n=(r=[e,n])[0],e=r[1]),this.load(t,e).then(function(t){return n?n(t):t})},i),o.env("undefined"!=typeof self&&null!==self?self:globalThis),o.proxin=r,"undefined"!=typeof module&&null!==module?module.exports=o:window&&(window.rescope=o)}).call(this);
